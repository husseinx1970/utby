<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark only"/>
  <title>Utby Snabb Bilservice — Pålitlig bilservice i Göteborg</title>
  <meta name="description" content="Utby Snabb Bilservice i Göteborg: service, diagnos, bromsar, däck, AC och kompletta reparationer. Drop-in, vardagar 09:00–18:00, däckhotell."/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#DABD66">
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;background:#0b0c10;color:#f6f7fb;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    img{max-width:100%;display:block}
    a{color:#DABD66;text-decoration:none}
    .container{width:min(1100px,100%);margin:auto;padding:0 18px}

    /* Header */
    .header{position:sticky;top:0;z-index:10;background:rgba(12,13,18,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.1)}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:64px;height:64px;border-radius:12px;object-fit:contain;filter:drop-shadow(0 0 12px rgba(218,189,102,.3))}
    .brand-name{font-weight:800;font-size:18px;line-height:1;font-family:'Space Grotesk',Inter;color:#fff}
    .nav{display:flex;gap:8px}
    .nav a{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:700;font-size:14px;border:1px solid rgba(255,255,255,.12)}
    .nav a.secondary{background:rgba(255,255,255,.06);color:#fff}
    .nav a:not(.secondary){background:#DABD66;color:#111}

    /* Hero */
    .hero{text-align:center;padding:30px 0}
    h1{font-family:'Space Grotesk',Inter;font-weight:800;font-size:clamp(26px,6vw,40px);background:linear-gradient(90deg,#fff,#DABD66);-webkit-background-clip:text;color:transparent;margin:.6em 0}
    .lead{color:#C9D2DE;max-width:65ch;margin:0 auto 16px}
    .btn{padding:9px 14px;border-radius:12px;font-weight:800;font-size:14px;border:1px solid rgba(255,255,255,.1)}
    .btn.primary{background:#DABD66;color:#111}
    .btn.ghost{background:rgba(255,255,255,.06);color:#fff}

    /* Sections */
    .section{padding:35px 0}
    .section h2{text-align:center;font-weight:800;font-size:22px;margin:0 0 10px;font-family:'Space Grotesk',Inter}
    .muted{text-align:center;color:#C9D2DE;margin:0 0 18px}

    /* Services */
    .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:14px}
    .card h3{margin:.1em 0 .2em;font-weight:700;font-size:17px}
    .card p{margin:0 0 6px}

    /* Booking & Contact Forms */
    .booking,.contact-form{display:grid;gap:10px;max-width:560px;margin:20px auto}
    .booking label,.contact-form label{font-weight:600;font-size:13px;color:#e6e8ef}
    .booking input,.booking select,.booking textarea,.contact-form input,.contact-form textarea{
      width:100%;height:42px;padding:8px 10px;border-radius:8px;
      border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);
      color:#fff;font-size:14px
    }
    .booking textarea,.contact-form textarea{height:auto;min-height:100px;resize:vertical}
    .booking input:focus,.booking select:focus,.booking textarea:focus,.contact-form input:focus,.contact-form textarea:focus{
      border-color:#d9b954;outline:none;box-shadow:0 0 0 2px rgba(218,189,102,.25)
    }
    .booking button,.contact-form button{margin-top:6px;padding:12px 14px;border-radius:999px;background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;font-weight:800;font-size:15px;border:none;cursor:pointer;box-shadow:0 4px 16px rgba(218,189,102,.25)}
    .booking button[disabled],.contact-form button[disabled]{opacity:.6;cursor:not-allowed}
    .booking button:hover,.contact-form button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(218,189,102,.35)}

    /* Contact Form Specific */
    .contact-form{padding:20px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:14px}
    .contact-form h3{text-align:center;font-weight:800;font-size:20px;margin:0 0 15px;color:#fff}
    #contactStatus{margin-top:10px;padding:10px;border-radius:8px;text-align:center;display:none}
    #contactStatus.success{background:rgba(34,197,94,.12);color:#4ade80;border:1px solid rgba(34,197,94,.25)}
    #contactStatus.error{background:rgba(239,68,68,.08);color:#f87171;border:1px solid rgba(239,68,68,.2)}
    #contactStatus.info{background:rgba(255,215,90,.06);color:#f6e7b8;border:1px solid rgba(218,189,102,.12)}

    /* Custom dropdown list (searchable problem/tjänst) */
    .custom-dropdown{position:relative;width:100%;margin-bottom:14px}
    .custom-dropdown input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.03);color:#eee;font-size:15px;outline:none}
    .custom-dropdown input::placeholder{color:rgba(255,255,255,0.4)}
    .dropdown-list{position:absolute;top:100%;left:0;right:0;max-height:220px;overflow-y:auto;background:#111;border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:6px 0;list-style:none;margin:6px 0 0 0;display:none;z-index:999}
    .dropdown-list li{padding:10px 14px;color:#ddd;cursor:pointer}
    .dropdown-list li:hover{background:rgba(255,215,90,0.12);color:#fff}
    .custom-dropdown::after{content:"▾";position:absolute;right:14px;top:12px;color:rgba(255,255,255,0.4);pointer-events:none;font-size:18px}

    /* Map */
    .map-container{text-align:center;margin-top:22px}
    iframe{width:100%;height:240px;border:0;border-radius:12px}

    /* Footer */
    .site-footer{margin-top:32px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));border-top:1px solid rgba(255,255,255,.12)}
    .footer-top{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:16px;padding:22px 0 12px}
    .site-footer h4{font-weight:800;font-size:16px;color:#fff;margin:.2em 0 .5em}
    .site-footer p,.site-footer a,.site-footer li{color:#C9D2DE;font-size:14px;line-height:1.6}
    .footer-divider{height:2px;background:linear-gradient(90deg,transparent,rgba(218,189,102,.7),transparent);margin:8px 0 12px}
    .copyright-bar{text-align:center;padding:10px 0 16px;font-size:13px;color:#BFC7D4;border-top:1px solid rgba(255,255,255,.08)}
    .copyright-bar a{color:#DABD66;font-weight:700}

    /* Modals */
    .modal{position:fixed;inset:0;display:none;place-items:center;z-index:20;background:rgba(8,10,14,.55);backdrop-filter:blur(14px)}
    .modal.show{display:grid}
    .modal-card{width:min(620px,92vw);background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.14);border-radius:18px;padding:18px;box-shadow:0 32px 90px rgba(0,0,0,.52)}
    .modal-header{display:flex;align-items:center;gap:10px;justify-content:flex-start;margin-bottom:12px}
    .action{display:block;width:100%;text-align:center;font-weight:900;border-radius:12px;padding:12px;margin:10px 0}
    .action.call{background:#111;color:#DABD66;border:1px solid rgba(255,255,255,.08)}
    .action.mail{background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;border:none}
    .modal-close{display:block;margin:14px auto 2px;text-align:center;color:#9fb0c0;cursor:pointer}

    /* SMS FAB draggable */
    .sms-fab{position:fixed;right:14px;bottom:14px;width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;border:1px solid rgba(0,0,0,.2);text-decoration:none;transition:.15s;box-shadow:none !important;touch-action:none;z-index:100}
    .sms-fab svg{width:24px;height:24px}

    /* small screens */
    @media(max-width:520px){.footer-top{grid-template-columns:1fr}.brand img{width:54px;height:54px}.nav{flex-wrap:wrap}}
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header" id="start">
    <div class="container header-inner">
      <a class="brand" href="#start"><img src="assets/logo.png" alt="logo"/><span class="brand-name">Utby Snabb Bilservice</span></a>
      <nav class="nav" role="navigation" aria-label="Main">
        <a class="secondary" href="#tjanster">Tjänster</a>
        <a class="secondary" href="#kontakt">Kontakt</a>
        <a href="#boka">Boka tid</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" aria-labelledby="hero-title">
    <div class="container">
      <h1 id="hero-title">Boka tid</h1>
      <p class="lead">Komplett service, reparation och diagnos för alla bilmärken. Drop-in välkommen — vardagar 09:00–18:00.</p>
    </div>
  </section>

  <!-- Services -->
  <section class="section" id="tjanster" aria-labelledby="services-title">
    <div class="container">
      <h2 id="services-title">Våra tjänster</h2>
      <p class="muted">Vi hanterar allt från motor och växellåda till minsta komponent. Du får alltid prisförslag innan åtgärd och tydlig återkoppling när arbetet är klart.</p>

      <div class="services" role="list">
        <div class="card" role="listitem">
          <h3>Service</h3>
          <p>Planerad service enligt tillverkarens intervall: byte av motorolja och filter, kontroll av vätskor, bromsar, batteri, belysning och drivlina.</p>
        </div>
        <div class="card" role="listitem">
          <h3>Däck & hjul</h3>
          <p>Skifte sommar/vinter, balansering och kontroll av mönsterdjup och lufttryck. Vi programmerar och kalibrerar även TPMS vid behov.</p>
        </div>
        <div class="card" role="listitem">
          <h3>Kompletta reparationer</h3>
          <p>Från bromsar, avgassystem och fjädring till motor, koppling/växellåda och el. Vi felsöker systematiskt med moderna diagnosverktyg.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Booking / Contact -->
  <section class="section" id="boka" aria-labelledby="booking-title">
    <div class="container">
      <h2 id="booking-title" style="text-align:center;color:#fff;margin-bottom:12px">Kontakt oss & Boka tid</h2>

      <div class="contact-form" role="region" aria-label="Boka tid formular">
        <h3>Boka tid</h3>

        <!-- FORM: EmailJS only (no action attribute) -->
        <form id="contactForm" novalidate autocomplete="on">
          <input type="text" name="_honey" style="display:none" autocomplete="off">

          <label for="name">Namn</label>
          <input id="name" name="name" placeholder="För- och efternamn" required>

          <label for="contactPhone">Telefon (valfritt)</label>
          <input id="contactPhone" name="phone" type="tel" placeholder="072-123 45 67">

          <label for="email">E-post</label>
          <input id="email" name="email" type="email" placeholder="din@epost.se" required>

          <label for="car">Bil/Regnr</label>
          <input id="car" name="car" placeholder="Ex: ABC123 eller Volvo V60 2017">

          <label for="issueInput">Problem / Tjänst</label>
          <div class="custom-dropdown" id="issueDropdown" aria-haspopup="listbox">
            <input type="text" id="issueInput" name="issue" placeholder="Välj eller sök tjänst..." autocomplete="off" aria-label="Problem eller tjänst">
            <ul class="dropdown-list" role="listbox" aria-labelledby="issueInput">
              <li role="option">Annat – beskriv i meddelandet</li>
              <li role="option">Service & olja</li>
              <li role="option">Bromsar</li>
              <li role="option">Däck & hjul</li>
              <li role="option">AC / klimatanläggning</li>
              <li role="option">El / elektronik</li>
              <li role="option">Diagnos / OBD</li>
              <li role="option">Motor</li>
              <li role="option">Växellåda / koppling</li>
              <li role="option">Besiktning / kontroll</li>
            </ul>
          </div>

          <div class="inline-dt" aria-hidden="false">
            <div>
              <label for="date">Önskat datum</label>
              <input id="date" name="date" type="date">
            </div>
            <div>
              <label for="time">Önskad tid</label>
              <input id="time" name="time" type="time">
            </div>
          </div>

          <label for="contactMessage">Meddelande</label>
          <textarea id="contactMessage" name="message" placeholder="Berätta vad du behöver hjälp med..."></textarea>

          <button type="submit">Skicka meddelande</button>

          <div id="contactStatus" role="status" aria-live="polite"></div>
        </form>
      </div>

      <div class="map-container" id="kontakt">
        <h3>Här hittar du oss</h3>
        <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
        <iframe src="https://www.google.com/maps?q=57.74025,12.07864&hl=sv&z=15&output=embed" loading="lazy" referrerpolicy="no-referrer"></iframe>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer" id="footer">
    <div class="container footer-top">
      <div>
        <h4>Kontakt</h4>
        <p><strong>Utby Snabb Bilservice</strong></p>
        <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
        <p>Telefon: <a href="tel:+46720040936">072-004 09 36</a></p>
        <p>E-post: <a href="mailto:info@utbysnabbbilservice.se">info@utbysnabbbilservice.se</a></p>
      </div>
      <div>
        <h4>Öppettider</h4>
        <ul>
          <li><strong>Vardagar:</strong> 09:00 – 18:00</li>
          <li>Lördag: enligt överenskommelse</li>
        </ul>
      </div>
      <div>
        <h4>Om verkstaden</h4>
        <ul>
          <li>Service, diagnos, bromsar, däck, AC och el</li>
          <li>Kompletta reparationer — motor & växellåda</li>
        </ul>
        <p style="margin-top:6px"><a href="https://maps.google.com/?q=57.74025,12.07864" target="_blank" rel="noopener">Hitta oss på Google Maps</a></p>
      </div>
    </div>

    <div class="footer-divider"></div>

    <div class="container copyright-bar">
      <span>© 2023 Utby Snabb Bilservice</span> |
      <span>Design by <a href="#" id="openCreator">Hussein</a></span>
    </div>
  </footer>

  <!-- Modals -->
  <div class="modal" id="creatorModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <img src="assets/logo.png" alt="Logotyp" style="width:40px;height:40px;border-radius:8px">
        <div>
          <h3>Kontakta Hussein</h3>
          <p>Via denna hemsida kan du nå mig direkt — via e-post eller mobil. Jag återkommer så snart som möjligt.</p>
        </div>
      </div>
      <a class="action call" href="tel:+46790574975">Ring: 0790574975</a>
      <a class="action mail" href="mailto:hussein.alsamli02@gmail.com">Skicka e-post</a>
      <span class="modal-close" id="closeCreator">Stäng</span>
    </div>
  </div>

  <div class="modal" id="thanksModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <img src="assets/logo.png" alt="Logotyp" style="width:40px;height:40px;border-radius:8px">
        <div>
          <h3>Tack!</h3>
          <p>Din förfrågan har skickats. Vi återkommer så snart som möjligt.</p>
        </div>
      </div>
      <span class="modal-close" id="thanksClose">Stäng</span>
    </div>
  </div>

  <div class="modal" id="chooserModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <img src="assets/logo.png" alt="Logotyp" style="width:40px;height:40px;border-radius:8px">
        <div>
          <h3>Välj kontaktmetod</h3>
          <p>Vill du skicka SMS eller E-post?</p>
        </div>
      </div>
      <a class="action call" id="chooserSms" href="#">Skicka SMS</a>
      <a class="action mail" id="chooserMail" href="mailto:info@utbysnabbbilservice.se?subject=Bokningsförfrågan">Skicka e-post</a>
      <span class="modal-close" id="chooserClose">Stäng</span>
    </div>
  </div>

  <!-- SMS floating button -->
  <a id="smsFab" class="sms-fab" href="#" aria-label="Skicka SMS eller e-post">
    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20 2H4a2 2 0 00-2 2v16l4-4h14a2 2 0 002-2V4a2 2 0 01-2-2zM6 9h8v2H6V9zm0-4h12v2H6V5z"/></svg>
  </a>

  <!-- EmailJS lib -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
  (function(){
    /* ============================
       EmailJS configuration
       ============================ */
    const EMAILJS_PUBLIC_KEY = "vt_iAWB9MVGz6iT_X";
    const EMAILJS_SERVICE_ID = "service_6fai64h";
    const EMAILJS_TEMPLATE_ID = "template_7tccbsi";

    if (window.emailjs && typeof emailjs.init === 'function') {
      try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch (e) { console.warn('emailjs.init failed', e); }
    }

    /* ===== set min date for date input ===== */
    const dateInput = document.getElementById('date');
    if (dateInput) {
      const today = new Date();
      const y = today.getFullYear();
      const m = String(today.getMonth() + 1).padStart(2,'0');
      const d = String(today.getDate()).padStart(2,'0');
      dateInput.min = `${y}-${m}-${d}`;
    }

    /* ===== custom dropdown (searchable) ===== */
    const dropdown = document.getElementById('issueDropdown');
    if (dropdown) {
      const input = dropdown.querySelector('input');
      const list = dropdown.querySelector('.dropdown-list');

      input.addEventListener('focus', () => list.style.display = 'block');
      input.addEventListener('input', () => {
        const val = input.value.toLowerCase();
        list.querySelectorAll('li').forEach(li => {
          li.style.display = li.textContent.toLowerCase().includes(val) ? 'block' : 'none';
        });
      });
      list.querySelectorAll('li').forEach(li => {
        li.addEventListener('click', () => {
          input.value = li.textContent;
          list.style.display = 'none';
        });
      });
      document.addEventListener('click', e => {
        if (!dropdown.contains(e.target)) list.style.display = 'none';
      });
    }

    /* ===== SMS FAB chooser & draggable ===== */
    function initSmsFab() {
      const smsFab = document.getElementById('smsFab');
      const chooserModal = document.getElementById('chooserModal');
      const chooserSms = document.getElementById('chooserSms');
      const chooserClose = document.getElementById('chooserClose');

      if (!smsFab || !chooserModal) return;

      function getSmsHref() {
        const base = 'sms:+46720040936';
        const body = encodeURIComponent('Hej! Jag skulle vilja be om hjälp med min bil.');
        const ua = navigator.userAgent.toLowerCase();
        return (ua.includes('iphone') || ua.includes('ipad')) ? `${base}&body=${body}` : `${base}?body=${body}`;
      }

      function openChooser(e) {
        e.preventDefault();
        chooserModal.classList.add('show');
        document.body.classList.add('scroll-lock');
        const el = document.getElementById('chooserSms');
        if (el) el.href = getSmsHref();
      }
      function closeChooser(e) {
        e && e.preventDefault();
        chooserModal.classList.remove('show');
        document.body.classList.remove('scroll-lock');
      }

      smsFab.addEventListener('click', openChooser);
      if (chooserClose) chooserClose.addEventListener('click', closeChooser);
      chooserModal.addEventListener('click', e => { if (e.target === chooserModal) closeChooser(); });

      makeSmsFabDraggable(smsFab);
    }

    function makeSmsFabDraggable(el) {
      const MARGIN_X = 14, MARGIN_Y = 8, CLICK_TOL = 6;
      let dragging=false, startX=0, startY=0, startLeft=0, startTop=0, ptrId=null;

      function restore() {
        try {
          const saved = JSON.parse(localStorage.getItem('smsFabPosition')||'null');
          if(saved && (saved.side==='left'||saved.side==='right') && Number.isFinite(saved.top)) {
            el.style.top = Math.max(MARGIN_Y, saved.top) + 'px';
            if (saved.side==='left') { el.style.left = MARGIN_X + 'px'; el.style.right='auto'; }
            else { el.style.right = MARGIN_X + 'px'; el.style.left='auto'; }
          }
        }catch(e){}
      }
      function ensureLeftTop(){
        const rect = el.getBoundingClientRect();
        el.style.left = rect.left + 'px';
        el.style.top = rect.top + 'px';
        el.style.right = 'auto'; el.style.bottom='auto';
      }
      function clampTop(top) {
        const rect = el.getBoundingClientRect();
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight||0);
        return Math.min(vh - rect.height - MARGIN_Y, Math.max(MARGIN_Y, top));
      }
      function onDown(e) {
        if(ptrId!==null && e.pointerId!==ptrId) return;
        ptrId=e.pointerId;
        try{ e.target.setPointerCapture(ptrId); }catch(_){}
        dragging=true; startX=e.clientX; startY=e.clientY;
        ensureLeftTop();
        startLeft = parseFloat(el.style.left || el.getBoundingClientRect().left);
        startTop = parseFloat(el.style.top || el.getBoundingClientRect().top);
        el.style.transition='none';
        e.preventDefault();
      }
      function onMove(e) {
        if(!dragging || e.pointerId!==ptrId) return;
        const dx = e.clientX - startX, dy = e.clientY - startY;
        el.style.left = Math.round(startLeft + dx) + 'px';
        el.style.top = Math.round(startTop + dy) + 'px';
        e.preventDefault();
      }
      function onUp(e) {
        if(e.pointerId!==ptrId) return;
        try{ e.target.releasePointerCapture(ptrId); }catch(_){}
        const dx = e.clientX - startX, dy = e.clientY - startY;
        const moved = Math.hypot(dx,dy);
        dragging=false; ptrId=null;
        const rect = el.getBoundingClientRect();
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth||0);
        const side = (rect.left + rect.width/2 < vw/2) ? 'left' : 'right';
        const top = clampTop(parseFloat(el.style.top || rect.top));
        el.style.top = Math.round(top)+'px';
        if(side==='left'){ el.style.left = MARGIN_X + 'px'; el.style.right='auto'; }
        else { el.style.right = MARGIN_X + 'px'; el.style.left='auto'; }
        try{ localStorage.setItem('smsFabPosition', JSON.stringify({ side, top })); }catch(_){}
        if(moved > CLICK_TOL) {
          el.addEventListener('click', function once(ev){ ev.stopImmediatePropagation(); ev.preventDefault(); }, { once:true, capture:true });
        }
      }

      restore();
      el.addEventListener('pointerdown', onDown, { passive:false });
      window.addEventListener('pointermove', onMove, { passive:false });
      window.addEventListener('pointerup', onUp, { passive:false });
      window.addEventListener('pointercancel', onUp, { passive:false });
    }

    /* ===== generic modal wiring ===== */
    function wireModals() {
      const creatorModal = document.getElementById('creatorModal');
      const openCreator = document.getElementById('openCreator');
      const closeCreator = document.getElementById('closeCreator');
      if(openCreator && creatorModal){
        openCreator.addEventListener('click', function(e){ e.preventDefault(); creatorModal.classList.add('show'); document.body.classList.add('scroll-lock'); });
      }
      document.querySelectorAll('.modal .modal-close').forEach(btn => {
        btn.addEventListener('click', function(e){ e.preventDefault(); const modal = btn.closest('.modal'); if(modal){ modal.classList.remove('show'); document.body.classList.remove('scroll-lock'); }});
      });
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e){ if(e.target === modal){ modal.classList.remove('show'); document.body.classList.remove('scroll-lock'); }});
      });
    }

    /* ===== EmailJS send logic ===== */
    function showStatus(type, text){
      const el = document.getElementById('contactStatus');
      if(!el) return;
      el.style.display='block';
      el.className='';
      if(type==='success') el.classList.add('success');
      else if(type==='error') el.classList.add('error');
      else el.classList.add('info');
      el.textContent = text;
    }

    function prepareTemplateParams(form){
      return {
        from_name: (form.querySelector('[name="name"]')||{}).value || '',
        email: (form.querySelector('[name="email"]')||{}).value || '',
        phone: (form.querySelector('[name="phone"]')||{}).value || '',
        regnr: (form.querySelector('[name="car"]')||{}).value || '',
        problem: (form.querySelector('[name="issue"]')||{}).value || '',
        date: (form.querySelector('[name="date"]')||{}).value || '',
        time: (form.querySelector('[name="time"]')||{}).value || '',
        message: (form.querySelector('[name="message"]')||{}).value || ''
      };
    }

    function sendWithEmailJS(form){
      return new Promise((resolve,reject)=>{
        const honey = form.querySelector('input[name="_honey"]');
        if(honey && honey.value.trim()!=='') return reject(new Error('Bot suspected'));
        if(!EMAILJS_PUBLIC_KEY || !EMAILJS_SERVICE_ID || !EMAILJS_TEMPLATE_ID) return reject(new Error('EmailJS keys not configured'));
        if(!window.emailjs || typeof emailjs.send !== 'function') return reject(new Error('EmailJS library missing'));

        const params = prepareTemplateParams(form);
        showStatus('info', 'Skickar e-post...');
        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params)
          .then(resp => resolve(resp))
          .catch(err => reject(err));
      });
    }

    /* ===== attach form handler ===== */
    document.addEventListener('DOMContentLoaded', function(){
      wireModals();
      initSmsFab();

      const form = document.getElementById('contactForm');
      if(!form) return;

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        if(!form.checkValidity()){
          form.reportValidity();
          return;
        }

        try {
          await sendWithEmailJS(form);
          showStatus('success', 'Tack! Ditt meddelande har skickats. Vi återkommer så snart som möjligt.');
          form.reset();
          // show thanks modal
          const thanks = document.getElementById('thanksModal');
          if(thanks){ thanks.classList.add('show'); document.body.classList.add('scroll-lock'); }
        } catch (err) {
          console.error('EmailJS send error:', err);
          const msg = (err && err.text) ? ('Fel: ' + err.text) : 'Kunde inte skicka meddelandet just nu. Försök igen senare eller ring oss.';
          showStatus('error', msg);
        }
      });
    });

  })();
  </script>
</body>
</html>