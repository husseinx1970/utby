<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark only"/>
  <title>Utby Snabb Bilservice — Pålitlig bilservice i Göteborg</title>
  <meta name="description" content="Utby Snabb Bilservice i Göteborg: service, diagnos, bromsar, däck, AC och kompletta reparationer. Drop-in, vardagar 09:00–18:00, däckhotell."/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    /* ---- base (unchanged except additions) ---- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;background:#0b0c10;color:#f6f7fb;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    html,body{overflow-x:hidden}
    img{max-width:100%;display:block}
    a{color:#DABD66;text-decoration:none}
    .container{width:min(1100px,100%);margin:auto;padding:0 18px;position:relative;z-index:2}

    /* Header */
    .header{position:sticky;top:0;z-index:30;background:rgba(12,13,18,.65);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:64px;height:64px;border-radius:12px;object-fit:contain;filter:drop-shadow(0 0 12px rgba(218,189,102,.3))}
    .brand-name{font:800 18px/1 Space Grotesk;color:#fff}
    .nav{display:flex;gap:8px}
    .nav a{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:700;font-size:14px;border:1px solid rgba(255,255,255,.12);line-height:1}
    .nav a.secondary{background:rgba(255,255,255,.06);color:#fff}
    .nav a:not(.secondary){background:#DABD66;color:#111}
    .nav a .icon svg{width:16px;height:16px}

    /* Hero */
    .hero{text-align:center;padding:30px 0}
    h1{font-family:Space Grotesk,Inter;font-weight:800;font-size:clamp(26px,6vw,40px);background:linear-gradient(90deg,#fff,#DABD66);-webkit-background-clip:text;color:transparent;margin:.3em 0}
    .lead{color:#C9D2DE;max-width:65ch;margin:0 auto 16px}
    .cta{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    .btn{padding:9px 14px;border-radius:12px;font-weight:800;font-size:14px;border:1px solid rgba(255,255,255,.1);transition:.2s}
    .btn.primary{background:#DABD66;color:#111}
    .btn.ghost{background:rgba(255,255,255,.06);color:#fff}
    .btn:hover{transform:translateY(-2px)}
    .hero-logo{width:min(300px,60vw);margin:20px auto 0;filter:drop-shadow(0 10px 30px rgba(218,189,102,.35))}

    /* Sections */
    .section{padding:35px 0}
    .section h2{text-align:center;font:800 22px/1.3 Space Grotesk;margin:0 0 10px}
    .section p.muted{text-align:center;color:#C9D2DE;margin:0 0 18px}

    /* Forms/cards unchanged ... (kept from your original) */
    .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:14px}
    .card h3{margin:.1em 0 .2em;font:700 17px/1.2 Inter}
    .card p{margin:0 0 6px}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:10px;margin-top:8px}
    .booking,.contact-form{display:grid;gap:10px;max-width:560px;margin:20px auto}
    .booking label,.contact-form label{font-weight:600;font-size:13px;color:#e6e8ef}
    .booking input,.booking select,.booking textarea,.contact-form input,.contact-form textarea{
      width:100%;height:42px;padding:8px 10px;border-radius:8px;
      border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);
      color:#fff;font-size:14px
    }
    .booking textarea,.contact-form textarea{height:auto;min-height:100px;resize:vertical}
    .booking input:focus,.booking select:focus,.booking textarea:focus,.contact-form input:focus,.contact-form textarea:focus{
      border-color:#d9b954;outline:none;box-shadow:0 0 0 2px rgba(218,189,102,.25)
    }
    .booking button,.contact-form button{margin-top:6px;padding:12px 14px;border-radius:999px;background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;font-weight:800;font-size:15px;border:none;cursor:pointer;box-shadow:0 4px 16px rgba(218,189,102,.25)}
    .booking button[disabled],.contact-form button[disabled]{opacity:.6;cursor:not-allowed}
    .booking button:hover,.contact-form button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(218,189,102,.35)}

    /* Modal & map & footer unchanged (kept) */
    .map-container{text-align:center;margin-top:22px}
    iframe{width:100%;height:240px;border:0;border-radius:12px}
    .site-footer{margin-top:32px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));border-top:1px solid rgba(255,255,255,.12)}
    .footer-top{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:16px;padding:22px 0 12px}
    .site-footer h4{font:800 16px/1.2 Inter;color:#fff;margin:.2em 0 .5em}
    .site-footer p,.site-footer a,.site-footer li{color:#C9D2DE;font-size:14px;line-height:1.6}
    .footer-divider{height:2px;background:linear-gradient(90deg,transparent,rgba(218,189,102,.7),transparent);margin:8px 0 12px}

    /* canvas for particles */
    #bgCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none; /* keep events to page elements unless we explicitly listen */
      z-index: 0;
      display:block;
    }

    /* SMS FAB (draggable) with interactive label */
    .sms-fab{
      position:fixed;right:14px;bottom:14px;width:64px;height:64px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;
      border:1px solid rgba(0,0,0,.2);text-decoration:none;transition:transform .12s ease,box-shadow .12s;box-shadow:0 6px 22px rgba(0,0,0,0.35);
      touch-action:none;z-index:40;cursor:grab;
    }
    .sms-fab:active{cursor:grabbing}
    .sms-fab .label {
      position:absolute;left:calc(50% + 46px);top:50%;transform:translateY(-50%);white-space:nowrap;
      background:rgba(0,0,0,0.45);padding:6px 10px;border-radius:999px;color:#fff;font-weight:800;font-size:13px;backdrop-filter:blur(6px);
      transition:transform .12s ease,opacity .12s;opacity:0.95;pointer-events:none;
      transform-origin:left center;
    }

    /* when pointer near, enlarge label */
    .sms-fab.hovering { transform: translateY(-6px) scale(1.02); box-shadow:0 10px 32px rgba(0,0,0,0.45); }
    .sms-fab.hovering .label { transform: translateY(-50%) translateX(6px) scale(1.03); }

    /* page-fixed state: stop scrolling */
    .page-fixed html, .page-fixed body { height:100vh; overflow:hidden; }
    .page-fixed .fixed-overlay {
      position: fixed; inset: 10px 10px auto 10px; z-index: 60;
      display:flex;justify-content:flex-end; gap:8px; pointer-events:auto;
    }
    .fixed-overlay .unfreeze {
      background: rgba(0,0,0,0.6); color:#fff; border:1px solid rgba(255,255,255,0.08);
      padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }

    @media(max-width:520px){
      .footer-top{grid-template-columns:1fr}
      .brand img{width:54px;height:54px}
      .nav{flex-wrap:wrap}
      .sms-fab .label { display:none; } /* hide label on tiny screens to avoid overlap */
    }
  </style>
</head>
<body>

  <!-- canvas for particles/dust -->
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a class="brand" href="#start"><img src="assets/logo.png" alt="logo"/><span class="brand-name">Utby Snabb Bilservice</span></a>
      <nav class="nav">
        <a class="secondary" href="#tjanster">
          <span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19.3l-6.4-6.4a6 6 0 01-7.6-7.6l3.1 3.1 2.1-.7.7-2.1-3.1-3.1a6 6 0 007.6 7.6l6.4 6.4-2.8 2.8zM4 20a2 2 0 110-4 2 2 0 010 4z"/></svg></span>
          <span>Tjänster</span>
        </a>
        <a class="secondary" href="#kontakt">
          <span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.6 10.8a15.1 15.1 0 006.6 6.6l2.2-2.2a1 1 0 011-.24 11.6 11.6 0 003.6.57 1 1 0 011 1V20a1 1 0 01-1 1A17 17 0 013 4a1 1 0 011-1h3.5a1 1 0 011 1 11.6 11.6 0 00.57 3.6 1 1 0 01-.24 1l-2.23 2.2z"/></svg></span>
          <span>Kontakt</span>
        </a>
        <a href="#boka">
          <span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h2v2h6V2h2v2h3a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2h3V2z"/></svg></span>
          <span>Boka tid </span>
        </a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" id="start">
    <div class="container">
      <h1>Professionell bilservice i Göteborg</h1>
      <p class="lead">Komplett service، reparation och diagnos för alla bilmärken. Drop-in välkommen — vardagar 09:00–18:00. Vi erbjuder däckhotell och full bilservice.</p>
      <div class="cta">
        <a class="btn primary" href="#boka">Boka tid</a>
        <a class="btn ghost" href="tel:+46720040936">Ring 072-004 09 36</a>
      </div>
      <img class="hero-logo" src="assets/logo.png" alt="Utby Snabb Bilservice logotyp">
    </div>
  </section>

  <!-- Tjänster (kortat för brevity, behåll ditt innehåll) -->
  <section class="section" id="tjanster">
    <div class="container">
      <h2>Våra tjänster</h2>
      <p class="muted">Vi hanterar allt från motor och växellåda till minsta komponent.</p>
      <div class="services">
        <div class="card"><h3>Service</h3><p>...</p></div>
        <div class="card"><h3>Däck & hjul</h3><p>...</p></div>
        <div class="card"><h3>Kompletta reparationer</h3><p>...</p></div>
      </div>
    </div>
  </section>

  <!-- Boka & Kontakt (behåll ditt formulär original) -->
  <section class="section" id="boka">
    <div class="container">
      <h2>Kontakt oss & Boka tid</h2>
      <div class="contact-form">
        <h3>Boka tid</h3>
        <form id="contactForm" action="https://formsubmit.co/snabbservise@hotmail.com" method="POST">
          <input type="hidden" name="_template" value="table">
          <input type="hidden" name="_subject" value="Nytt meddelande — Utby Snabb Bilservice">
          <input type="hidden" name="_captcha" value="false">
          <input type="text" name="_honey" style="display:none">

          <label for="name">Namn </label>
          <input id="name" name="name" placeholder="För- och efternamn" required>

          <label for="contactPhone">Telefon (valfritt)</label>
          <input id="contactPhone" name="phone" type="tel" placeholder="072-123 45 67">

          <label for="email">E-post </label>
          <input id="email" name="email" type="email" placeholder="din@epost.se" required>

          <label for="car">Bil/Regnr </label>
          <input id="car" name="car" placeholder="Ex: ABC123 eller Volvo V60 2017" required>

          <!-- simplified issue dropdown -->
          <label for="issueInput">Problem / Tjänst</label>
          <div class="custom-dropdown" id="issueDropdown">
            <input type="text" id="issueInput" name="issue" placeholder="Välj eller sök tjänst..." required autocomplete="off">
            <ul class="dropdown-list">
              <li>Annat – beskriv i meddelandet</li>
              <li>Service & olja</li>
              <li>Bromsar</li>
              <li>Däck & hjul</li>
              <li>Diagnos / OBD</li>
            </ul>
          </div>

          <div class="inline-dt">
            <div class="field">
              <label for="date">Önskat datum *</label>
              <input id="date" name="date" type="date" required>
            </div>
            <div class="field">
              <label for="time">Önskad tid </label>
              <input id="time" name="time" type="time" required>
            </div>
          </div>

          <label for="contactMessage">Meddelande </label>
          <textarea id="contactMessage" name="message" placeholder="Berätta vad du behöver hjälp med..." required></textarea>

          <button type="submit">Skicka meddelande</button>
          <div id="contactStatus"></div>
        </form>
      </div>

      <div class="map-container" id="kontakt">
        <h3>Här hittar du oss</h3>
        <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
        <iframe src="https://www.google.com/maps?q=57.74025,12.07864&hl=sv&z=15&output=embed" loading="lazy" referrerpolicy="no-referrer"></iframe>
      </div>
    </div>
  </section>

  <!-- Footer (unchanged) -->
  <footer class="site-footer">
    <div class="container footer-top">
      <div><h4>Kontakt</h4><p><strong>Utby Snabb Bilservice</strong></p><p>Vagnmakaregatan 2, 415 72 Göteborg</p><p>Telefon: <a href="tel:+46720040936">072-004 09 36</a></p></div>
      <div><h4>Öppettider</h4><ul><li><strong>Vardagar:</strong> 09:00 – 18:00</li><li>Lördag: enligt överenskommelse</li></ul></div>
      <div><h4>Om verkstaden</h4><ul><li>Service, diagnos, bromsar, däck, AC och el</li></ul></div>
    </div>
    <div class="footer-divider"></div>
    <div class="container copyright-bar">
      <span>© 2023 Utby Snabb Bilservice</span> | <span>Design by <a href="#" id="openCreator">Hussein</a></span>
    </div>
  </footer>

  <!-- Modal: Kontakta Hussein -->
  <div class="modal" id="creatorModal">
    <div class="modal-card">
      <div class="modal-header">
        <img src="assets/logo.png" alt="Logotyp">
        <div><h3>Kontakta Hussein</h3><p>Via denna hemsida kan du nå mig direkt — via e-post eller mobil.</p></div>
      </div>
      <a class="action call" href="tel:+46790574975">Ring: 0790574975</a>
      <a class="action mail" href="mailto:hussein.alsamli02@gmail.com">Skicka e-post</a>
      <span class="modal-close" id="closeCreator">Stäng</span>
    </div>
  </div>

  <!-- Modal: chooser -->
  <div class="modal" id="chooserModal">
    <div class="modal-card">
      <div class="modal-header">
        <img src="assets/logo.png" alt="Logotyp">
        <div><h3>Välj kontaktmetod</h3><p>Vill du skicka SMS eller E-post?</p></div>
      </div>
      <a class="action call" id="chooserSms" href="#">Skicka SMS</a>
      <a class="action mail" id="chooserMail" href="mailto:info@utbysnabbbilservice.se?subject=Bokningsförfrågan">Skicka e-post</a>
      <span class="modal-close" id="chooserClose">Stäng</span>
    </div>
  </div>

  <!-- SMS FAB (draggable) -->
  <a id="smsFab" class="sms-fab" href="#" aria-label="Skicka SMS eller e-post">
    <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28"><path d="M20 2H4a2 2 0 00-2 2v16l4-4h14a2 2 0 002-2V4a2 2 0 01-2-2zM6 9h8v2H6V9zm0-4h12v2H6V5z"/></svg>
    <span class="label">SMS / Kontakta oss</span>
  </a>

  <!-- optional overlay shown when page fixed -->
  <div class="fixed-overlay" style="display:none;pointer-events:none;z-index:60"></div>

  <script>
    /* ==========================
       Particles background (enhanced)
       ========================== */
    (function(){
      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d', { alpha: true });
      let W = window.innerWidth, H = window.innerHeight;
      const DPR = Math.max(1, window.devicePixelRatio || 1);

      function setSize(){
        W = window.innerWidth; H = window.innerHeight;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
      }
      setSize();

      function rand(min,max){ return Math.random()*(max-min)+min; }

      // particle class
      function Particle(i){
        this.reset(true);
      }
      Particle.prototype.reset = function(startOnScreen){
        this.x = rand(-W*0.05, W * 1.05);
        this.y = startOnScreen ? rand(0, H) : H + rand(4, 120);
        this.vx = rand(-0.15, 0.15);
        this.vy = rand(-0.18, -0.6);
        this.baseSize = rand(0.8, 3.6);
        this.size = this.baseSize;
        this.life = rand(10, 28);
        this.age = 0;
        const tone = Math.round(rand(200, 245));
        this.alpha = rand(0.06, 0.36);
        this.color = `rgba(${tone},${tone},${tone},${this.alpha})`;
        this.blur = rand(0.8, 3.2);
        this.wob = rand(0.2, 1.2);
      };
      Particle.prototype.step = function(dt, mx, my){
        // attraction / repel to pointer
        if (mx !== null) {
          const dx = this.x - mx, dy = this.y - my;
          const d2 = dx*dx + dy*dy;
          if (d2 < 25000) {
            // push away a bit
            const f = (1 - (Math.sqrt(d2)/160)) * 0.9;
            this.vx += (dx / (Math.sqrt(d2)+6)) * 0.08 * f;
            this.vy += (dy / (Math.sqrt(d2)+6)) * 0.08 * f;
          } else if (d2 < 90000) {
            // slight attraction
            const f = 0.015;
            this.vx += ((mx - this.x) * f) * 0.01;
            this.vy += ((my - this.y) * f) * 0.01;
          }
        }

        // sway
        this.vx += Math.sin((this.age * 0.6) + this.wob) * 0.002;
        this.x += this.vx * dt * 60;
        this.y += this.vy * dt * 60;
        this.age += dt;
        // fade/respawn
        if (this.y + this.size < -40 || this.age > this.life) this.reset(false);
        // size breathing
        this.size = this.baseSize + Math.sin(this.age*1.5)*0.3;
      };
      Particle.prototype.draw = function(ctx){
        ctx.save();
        ctx.globalCompositeOperation = 'lighter';
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.shadowColor = this.color;
        ctx.shadowBlur = this.blur * 6;
        ctx.arc(this.x, this.y, Math.max(0.2,this.size), 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      };

      let particles = [];
      function initParticles(){
        // count scaled + increased
        const base = Math.round((W*H)/70000);
        const count = Math.max(30, Math.min(380, base));
        particles = [];
        for(let i=0;i<count;i++) particles.push(new Particle(true));
      }
      initParticles();

      let last = performance.now();
      let mouseX = null, mouseY = null, pointerActive = false;

      function drawBackground(){
        const g = ctx.createLinearGradient(0,0,0,H);
        g.addColorStop(0, 'rgba(8,9,12,0.96)');
        g.addColorStop(1, 'rgba(12,13,18,0.99)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
      }

      function loop(now){
        const dt = Math.min(0.09, (now - last)/1000);
        last = now;
        ctx.clearRect(0,0,W,H);
        drawBackground();
        for(const p of particles){ p.step(dt, pointerActive ? mouseX : null, pointerActive ? mouseY : null); p.draw(ctx); }
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      // pointer interaction
      function onPointerMove(e){
        const p = e.touches ? e.touches[0] : e;
        mouseX = p.clientX;
        mouseY = p.clientY;
        pointerActive = true;
      }
      function onPointerLeave(){ pointerActive = false; mouseX = null; mouseY = null; }

      window.addEventListener('mousemove', onPointerMove, {passive:true});
      window.addEventListener('touchmove', onPointerMove, {passive:true});
      window.addEventListener('mouseleave', onPointerLeave);
      window.addEventListener('touchend', onPointerLeave);

      // resize
      let resizeTimer;
      window.addEventListener('resize', function(){
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function(){
          setSize();
          initParticles();
        }, 120);
      });
    })();
    /* ============== end particles ============== */

    /* ===============================
       Page-freeze on quick scroll up
       =============================== */
    (function(){
      let lastY = window.scrollY;
      let lastT = performance.now();
      let acc = 0;
      const THRESHOLD = -700; // negative = upward flick threshold (px/sec)
      const CHECK_MS = 120;
      let freeze = false;
      const overlayContainer = document.querySelector('.fixed-overlay');

      function setPageFixed(on){
        if(on){
          document.documentElement.classList.add('page-fixed');
          document.body.classList.add('page-fixed');
          // show overlay with unfreeze button
          if(overlayContainer){
            overlayContainer.style.pointerEvents = 'auto';
            overlayContainer.style.display = 'flex';
            overlayContainer.innerHTML = '<button class="unfreeze">Avsluta fixering</button>';
            const btn = overlayContainer.querySelector('.unfreeze');
            btn.addEventListener('click', () => setPageFixed(false));
          }
          freeze = true;
        } else {
          document.documentElement.classList.remove('page-fixed');
          document.body.classList.remove('page-fixed');
          if(overlayContainer){
            overlayContainer.style.display = 'none';
            overlayContainer.innerHTML = '';
            overlayContainer.style.pointerEvents = 'none';
          }
          freeze = false;
        }
      }

      let checkTimer = null;
      window.addEventListener('scroll', function(){
        const now = performance.now();
        const y = window.scrollY;
        const dy = y - lastY;
        const dt = Math.max(1, now - lastT);
        const speed = (dy / dt) * 1000; // px/sec
        // if fast upward scroll (large negative speed) -> freeze
        if(speed < THRESHOLD && !freeze){
          setPageFixed(true);
        }
        lastY = y;
        lastT = now;
        // small safety: if user scrolls down while frozen, unfreeze
        if(freeze && speed > 200) setPageFixed(false);
      }, {passive:true});

      // also allow two-finger swipe up (touch)
      let touchStartY = null;
      let touchStartT = null;
      window.addEventListener('touchstart', e => {
        if(e.touches && e.touches[0]){
          touchStartY = e.touches[0].clientY;
          touchStartT = performance.now();
        }
      }, {passive:true});
      window.addEventListener('touchend', e => {
        if(touchStartY === null) return;
        const endT = performance.now();
        const dt = Math.max(1, endT - touchStartT);
        // approximate last touch position via changedTouches or use 0
        const lastYpos = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : touchStartY;
        const dy = lastYpos - touchStartY;
        const speed = (dy / dt) * 1000;
        if(speed < THRESHOLD && !freeze) setPageFixed(true);
        touchStartY = null; touchStartT = null;
      }, {passive:true});

      // expose helper to unfreeze by code if needed
      window.unfreezePage = () => setPageFixed(false);
    })();

    /* ============================
       SMS FAB draggable + interactive label
       ============================ */
    (function(){
      const fab = document.getElementById('smsFab');
      const label = fab.querySelector('.label');
      let pointerId = null;
      let dragging = false;
      let startX=0, startY=0, startLeft=0, startTop=0;

      function ensureLeftTop(){
        const rect = fab.getBoundingClientRect();
        if(!fab.style.left) fab.style.left = rect.left + 'px';
        if(!fab.style.top) fab.style.top = rect.top + 'px';
        fab.style.right = 'auto';
        fab.style.bottom = 'auto';
      }

      function onPointerDown(e){
        pointerId = e.pointerId;
        try{ e.target.setPointerCapture(pointerId); }catch{}
        dragging = true;
        fab.classList.add('hovering');
        startX = e.clientX; startY = e.clientY;
        ensureLeftTop();
        startLeft = parseFloat(fab.style.left || 0);
        startTop = parseFloat(fab.style.top || 0);
        e.preventDefault();
      }
      function onPointerMove(e){
        if(!dragging || e.pointerId !== pointerId) return;
        const dx = e.clientX - startX, dy = e.clientY - startY;
        fab.style.left = Math.round(startLeft + dx) + 'px';
        fab.style.top = Math.round(startTop + dy) + 'px';
        // update label tilt based on movement
        const tilt = Math.max(-8, Math.min(8, dx / 6));
        label.style.transform = `translateY(-50%) translateX(6px) rotate(${tilt}deg) scale(1.02)`;
      }
      function onPointerUp(e){
        if(e.pointerId !== pointerId) return;
        dragging = false;
        try{ e.target.releasePointerCapture(pointerId); }catch{}
        fab.classList.remove('hovering');
        // snap to left/right edge
        const rect = fab.getBoundingClientRect();
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const side = (rect.left + rect.width/2 < vw/2) ? 'left' : 'right';
        const MARGIN = 14;
        if(side === 'left'){ fab.style.left = MARGIN + 'px'; fab.style.right = 'auto'; }
        else { fab.style.right = MARGIN + 'px'; fab.style.left = 'auto'; }
        pointerId = null;
        label.style.transform = ''; // reset tilt
      }

      // show label on hover/move (desktop) and on touchstart for mobile
      fab.addEventListener('pointerenter', () => fab.classList.add('hovering'));
      fab.addEventListener('pointerleave', () => { if(!dragging) fab.classList.remove('hovering'); });
      fab.addEventListener('pointerdown', onPointerDown);
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
      window.addEventListener('pointercancel', onPointerUp);

      // build sms href dynamically
      function getSmsHref(){
        const base = 'sms:+46720040936';
        const body = encodeURIComponent('Hej! Jag skulle vilja be om hjälp med min bil.');
        const ua = navigator.userAgent.toLowerCase();
        return (ua.includes('iphone')||ua.includes('ipad')) ? `${base}&body=${body}` : `${base}?body=${body}`;
      }
      const chooserSms = document.getElementById('chooserSms');
      if(chooserSms) chooserSms.href = getSmsHref();

    })();

    /* ===========================
       small UI helpers (forms, modals)
       =========================== */
    document.addEventListener('DOMContentLoaded', function() {
      // date min
      const dateInput = document.getElementById('date');
      if (dateInput){
        const today = new Date(); const y = today.getFullYear(); const m = String(today.getMonth()+1).padStart(2,'0'); const d = String(today.getDate()).padStart(2,'0');
        dateInput.min = `${y}-${m}-${d}`;
      }

      // open creator modal
      const openCreator = document.getElementById('openCreator');
      const creatorModal = document.getElementById('creatorModal');
      const closeCreator = document.getElementById('closeCreator');
      if(openCreator && creatorModal){
        openCreator.addEventListener('click', function(e){ e.preventDefault(); creatorModal.classList.add('show'); document.body.classList.add('scroll-lock'); });
      }
      if(closeCreator){
        closeCreator.addEventListener('click', function(e){ e.preventDefault(); creatorModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); });
      }
      if(creatorModal) creatorModal.addEventListener('click', function(e){ if(e.target===creatorModal){ creatorModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); } });

      // contact form submit (keeps previous behavior)
      const contactForm = document.getElementById('contactForm');
      const contactStatus = document.getElementById('contactStatus');
      if(contactForm){
        contactForm.addEventListener('submit', async function(e){
          e.preventDefault();
          const submitBtn = contactForm.querySelector('button[type="submit"]');
          const originalText = submitBtn.textContent;
          submitBtn.disabled = true; submitBtn.textContent = 'Skickar...';
          contactStatus.style.display = 'none';
          try {
            const formData = new FormData(contactForm);
            const response = await fetch(contactForm.action, { method:'POST', headers:{ 'Accept':'application/json' }, body: formData });
            if(response.ok){
              contactStatus.textContent = 'Tack! Ditt meddelande har skickats. Vi återkommer så snart som möjligt.';
              contactStatus.className = 'success';
              contactStatus.style.display = 'block';
              contactForm.reset();
            } else throw new Error('Något gick fel');
          } catch (err){
            contactStatus.textContent = 'Något gick fel. Vänligen försök igen eller ring oss direkt.';
            contactStatus.className = 'error';
            contactStatus.style.display = 'block';
          } finally {
            submitBtn.disabled = false; submitBtn.textContent = originalText;
          }
        });
      }

      // issue dropdown simple behavior
      (function(){
        const dropdown = document.getElementById("issueDropdown");
        if(!dropdown) return;
        const input = dropdown.querySelector("input");
        const list = dropdown.querySelector(".dropdown-list");
        input.addEventListener("focus", () => list.style.display = "block");
        input.addEventListener("input", () => {
          const filter = input.value.toLowerCase();
          const items = list.querySelectorAll("li");
          items.forEach(li => { li.style.display = li.textContent.toLowerCase().includes(filter) ? "block" : "none"; });
        });
        list.querySelectorAll("li").forEach(li=> li.addEventListener('click', ()=> { input.value = li.textContent; list.style.display = 'none'; }));
        document.addEventListener('click', e => { if(!dropdown.contains(e.target)) list.style.display = 'none'; });
      })();
    });
  </script>
</body>
</html>