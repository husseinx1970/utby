<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark only"/>
  <title>Utby Snabb Bilservice — Pålitlig bilservice i Göteborg</title>
  <meta name="description" content="Utby Snabb Bilservice i Göteborg: service, diagnos, bromsar, däck, AC och kompletta reparationer. Drop-in, vardagar 09:00–18:00, däckhotell."/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    /* ---------- Base ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;background:#0b0c10;color:#f6f7fb;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    img{max-width:100%;display:block}
    a{color:#DABD66;text-decoration:none}
    .container{width:min(1100px,100%);margin:auto;padding:0 18px}

    /* ---------- Header ---------- */
    .header{position:sticky;top:0;z-index:40;background:rgba(12,13,18,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:56px;height:56px;border-radius:10px;object-fit:contain}
    .brand-name{font-weight:800;font-family:"Space Grotesk",Inter;font-size:18px}
    .nav{display:flex;gap:8px}
    .nav a{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:700;font-size:14px;border:1px solid rgba(255,255,255,.06)}
    .nav a.secondary{background:rgba(255,255,255,.04);color:#fff}
    .nav a.primary{background:#DABD66;color:#111}

    /* ---------- Hero ---------- */
    .hero{text-align:center;padding:36px 0 18px;position:relative;z-index:20}
    h1{font-family:Space Grotesk,Inter;font-weight:800;font-size:clamp(26px,6vw,40px);background:linear-gradient(90deg,#fff,#DABD66);-webkit-background-clip:text;color:transparent;margin:.2em 0}
    .lead{color:#C9D2DE;max-width:65ch;margin:0 auto 16px}
    .cta{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:12px}

    /* ---------- Cards / Sections ---------- */
    .section{padding:30px 0;position:relative;z-index:20}
    .section h2{text-align:center;font-weight:800;margin:0 0 10px}
    .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px}
    .card h3{margin:.1em 0 .2em}

    /* ---------- Forms ---------- */
    .contact-form{display:grid;gap:10px;max-width:560px;margin:14px auto;padding:18px;background:rgba(255,255,255,.03);border-radius:12px;border:1px solid rgba(255,255,255,.06)}
    .contact-form label{font-weight:600;color:#e6e8ef}
    .contact-form input,.contact-form textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);color:#fff}
    .contact-form textarea{min-height:110px;resize:vertical}
    .contact-form button{padding:12px;border-radius:999px;background:linear-gradient(180deg,#e9cf6e,#d4b848);border:none;font-weight:800;cursor:pointer}

    /* ---------- Small controls ---------- */
    .inline-dt{display:grid;grid-template-columns:repeat(2,minmax(140px,1fr));gap:8px;align-items:end;margin-top:4px}
    @media(max-width:520px){.inline-dt{grid-template-columns:1fr}}

    /* ---------- Footer ---------- */
    .site-footer{margin-top:32px;padding-top:18px;position:relative;z-index:20}
    .footer-top{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:16px;padding:12px 0}
    @media(max-width:720px){.footer-top{grid-template-columns:1fr}}

    /* ---------- Modals ---------- */
    .modal{position:fixed;inset:0;display:none;place-items:center;z-index:80;background:rgba(8,10,14,.6);backdrop-filter:blur(8px)}
    .modal.show{display:grid}
    .modal-card{width:min(620px,92vw);background:#0d0e10;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,.04)}

    /* ---------- SMS FAB ---------- */
    .sms-fab{
      position:fixed;right:14px;bottom:14px;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;border:1px solid rgba(0,0,0,.2);z-index:70;touch-action:none;cursor:grab;
    }
    .sms-fab:active{cursor:grabbing}
    .sms-fab svg{width:24px;height:24px}

    /* ---------- Particles Canvas ---------- */
    #bgCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none; /* allow interaction with page */
      z-index: 0; /* behind content */
      display: block;
    }

    /* page content should sit above canvas */
    main, header, footer, section { position: relative; z-index: 20; }
  </style>
</head>
<body>

  <!-- Particles background canvas (only once) -->
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <a class="brand" href="#start"><img src="assets/logo.png" alt="logo"/><span class="brand-name">Utby Snabb Bilservice</span></a>
      <nav class="nav">
        <a class="secondary" href="#tjanster">Tjänster</a>
        <a class="secondary" href="#kontakt">Kontakt</a>
        <a class="primary" href="#boka">Boka tid</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero" id="start">
      <div class="container">
        <h1>Professionell bilservice i Göteborg</h1>
        <p class="lead">Komplett service, reparation och diagnos för alla bilmärken. Drop-in välkommen — vardagar 09:00–18:00.</p>
        <div class="cta">
          <a class="btn primary" href="#boka">Boka tid</a>
          <a class="btn ghost" href="tel:+46720040936">Ring 072-004 09 36</a>
        </div>
      </div>
    </section>

    <!-- Tjänster -->
    <section class="section" id="tjanster">
      <div class="container">
        <h2>Våra tjänster</h2>
        <div class="services">
          <div class="card"><h3>Service</h3><p>Planerad service enligt tillverkarens intervall.</p></div>
          <div class="card"><h3>Däck & hjul</h3><p>Skifte sommar/vinter, balansering och TPMS.</p></div>
          <div class="card"><h3>Reparationer</h3><p>Motor, växellåda, broms & el.</p></div>
        </div>
      </div>
    </section>

    <!-- Boka & Kontakt -->
    <section class="section" id="boka">
      <div class="container">
        <h2>Kontakt oss & Boka tid</h2>

        <div class="contact-form">
          <h3>Boka tid</h3>
          <form id="contactForm" action="https://formsubmit.co/snabbservise@hotmail.com" method="POST">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_subject" value="Nytt meddelande — Utby Snabb Bilservice">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="_honey" style="display:none">

            <label for="name">Namn</label>
            <input id="name" name="name" placeholder="För- och efternamn" required>

            <label for="contactPhone">Telefon (valfritt)</label>
            <input id="contactPhone" name="phone" type="tel" placeholder="072-123 45 67">

            <label for="email">E-post</label>
            <input id="email" name="email" type="email" placeholder="din@epost.se" required>

            <label for="car">Bil / Regnr</label>
            <input id="car" name="car" placeholder="Ex: ABC123 eller Volvo V60 2017" required>
            <div id="carInfo" aria-live="polite" style="display:none;margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:#e6e6e6;font-size:14px"></div>

            <label for="issueInput">Problem / Tjänst</label>
            <div class="custom-dropdown" id="issueDropdown" style="margin-bottom:12px">
              <input type="text" id="issueInput" name="issue" placeholder="Välj eller sök tjänst..." required autocomplete="off" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#eee">
              <ul class="dropdown-list" style="display:none;position:absolute;left:0;right:0;background:#111;border-radius:8px;padding:6px;margin-top:6px;z-index:50;list-style:none">
                <li style="padding:8px;cursor:pointer">Annat – beskriv i meddelandet</li>
                <li style="padding:8px;cursor:pointer">Service & olja</li>
                <li style="padding:8px;cursor:pointer">Bromsar</li>
                <li style="padding:8px;cursor:pointer">Däck & hjul</li>
                <li style="padding:8px;cursor:pointer">Diagnos / OBD</li>
              </ul>
            </div>

            <div class="inline-dt">
              <div class="field">
                <label for="date">Önskat datum *</label>
                <input id="date" name="date" type="date" required>
              </div>
              <div class="field">
                <label for="time">Önskad tid</label>
                <input id="time" name="time" type="time" required>
              </div>
            </div>

            <label for="contactMessage">Meddelande</label>
            <textarea id="contactMessage" name="message" placeholder="Berätta vad du behöver hjälp med..." required></textarea>

            <button type="submit" id="submitBtn">Skicka meddelande</button>
            <div id="contactStatus" style="margin-top:10px;display:none;padding:10px;border-radius:8px"></div>
          </form>
        </div>

        <div class="map-container" id="kontakt" style="text-align:center;margin-top:18px">
          <h3>Här hittar du oss</h3>
          <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
          <iframe src="https://www.google.com/maps?q=57.74025,12.07864&hl=sv&z=15&output=embed" loading="lazy" referrerpolicy="no-referrer" style="width:100%;height:240px;border:0;border-radius:10px"></iframe>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-top">
      <div>
        <h4>Kontakt</h4>
        <p><strong>Utby Snabb Bilservice</strong></p>
        <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
        <p>Telefon: <a href="tel:+46720040936">072-004 09 36</a></p>
      </div>
      <div>
        <h4>Öppettider</h4>
        <ul>
          <li><strong>Vardagar:</strong> 09:00 – 18:00</li>
          <li>Lördag: enligt överenskommelse</li>
        </ul>
      </div>
      <div>
        <h4>Om verkstaden</h4>
        <ul>
          <li>Service, diagnos, bromsar, däck, AC och el</li>
        </ul>
      </div>
    </div>
    <div style="text-align:center;padding:12px 0;color:#9fb0c0">© 2023 Utby Snabb Bilservice — Design by <a href="#" id="openCreator" style="color:#DABD66">Hussein</a></div>
  </footer>

  <!-- Modals -->
  <div class="modal" id="creatorModal">
    <div class="modal-card">
      <h3>Kontakta Hussein</h3>
      <p>Via denna hemsida kan du nå mig direkt — via e-post eller mobil. Jag återkommer så snart som möjligt.</p>
      <a class="action call" href="tel:+46790574975" style="display:inline-block;margin:8px 0;padding:10px;border-radius:8px;background:#111;color:#DABD66">Ring: 0790574975</a>
      <a class="action mail" href="mailto:hussein.alsamli02@gmail.com" style="display:inline-block;margin:8px 0;padding:10px;border-radius:8px;background:#DABD66;color:#111">Skicka e-post</a>
      <div style="text-align:center;margin-top:8px"><button id="closeCreator" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,.06);color:#c9d2de">Stäng</button></div>
    </div>
  </div>

  <div class="modal" id="chooserModal">
    <div class="modal-card">
      <h3>Välj kontaktmetod</h3>
      <p>Vill du skicka SMS eller E-post?</p>
      <div style="display:flex;gap:8px;flex-direction:column;margin-top:8px">
        <a id="chooserSms" class="action call" href="#" style="padding:10px;border-radius:8px;background:#111;color:#DABD66;text-align:center">Skicka SMS</a>
        <a id="chooserMail" class="action mail" href="mailto:info@utbysnabbbilservice.se?subject=Bokningsförfrågan" style="padding:10px;border-radius:8px;background:#DABD66;color:#111;text-align:center">Skicka e-post</a>
        <button id="chooserClose" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,.06);color:#c9d2de">Stäng</button>
      </div>
    </div>
  </div>

  <!-- SMS floating button -->
  <a id="smsFab" class="sms-fab" href="#" aria-label="Skicka SMS eller e-post" role="button" title="Skicka SMS eller e-post">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4a2 2 0 00-2 2v16l4-4h14a2 2 0 002-2V4a2 2 0 01-2-2zM6 9h8v2H6V9zm0-4h12v2H6V5z"/></svg>
  </a>

  <!-- ---------- Scripts: particles, form, UI ---------- -->
  <script>
  /* ======== Particles background (one canvas) ======== */
  (function(){
    const canvas = document.getElementById('bgCanvas');
    if(!canvas) return;
    const ctx = canvas.getContext('2d', { alpha: true });

    const CONFIG = {
      particleBaseDensity: 70000,
      minParticles: 30,
      maxParticles: 350,
      sizeMin: 0.8,
      sizeMax: 3.2,
      speedYMin: -0.08,
      speedYMax: -0.45,
      speedXRange: 0.16,
      glowMin: 0.6,
      glowMax: 2.8,
      alphaMin: 0.06,
      alphaMax: 0.34,
      pointerRepelRadius: 140,
      pointerActive: true
    };

    let DPR = Math.max(1, window.devicePixelRatio || 1);
    let W = innerWidth, H = innerHeight;

    function resize(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      W = innerWidth; H = innerHeight;
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
      initParticles();
    }
    window.addEventListener('resize', debounce(resize, 120));
    resize();

    function rand(a,b){ return Math.random()*(b-a)+a; }
    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function Particle(onScreen){
      this.reset(onScreen);
    }
    Particle.prototype.reset = function(onScreen){
      this.x = rand(-W*0.05, W*1.05);
      this.y = onScreen ? rand(0, H) : H + rand(4, 120);
      this.vx = rand(-CONFIG.speedXRange, CONFIG.speedXRange);
      this.vy = rand(CONFIG.speedYMin, CONFIG.speedYMax);
      this.baseSize = rand(CONFIG.sizeMin, CONFIG.sizeMax);
      this.size = this.baseSize;
      this.life = rand(10, 30);
      this.age = 0;
      const tone = Math.round(rand(200,245));
      this.alpha = rand(CONFIG.alphaMin, CONFIG.alphaMax);
      this.color = `rgba(${tone},${tone},${tone},${this.alpha})`;
      this.blur = rand(CONFIG.glowMin, CONFIG.glowMax);
      this.wob = rand(0.2, 1.4);
    };
    Particle.prototype.step = function(dt, mx, my, pointerActive){
      if(pointerActive && mx !== null){
        const dx = this.x - mx, dy = this.y - my;
        const d2 = dx*dx + dy*dy;
        const r = CONFIG.pointerRepelRadius;
        if(d2 < r*r){
          const f = (1 - Math.sqrt(d2)/r) * 0.9;
          this.vx += (dx / (Math.sqrt(d2)+6)) * 0.08 * f;
          this.vy += (dy / (Math.sqrt(d2)+6)) * 0.08 * f;
        }
      }
      this.vx += Math.sin((this.age * 0.6) + this.wob) * 0.002;
      this.x += this.vx * dt * 60;
      this.y += this.vy * dt * 60;
      this.age += dt;
      if(this.y + this.size < -40 || this.age > this.life) this.reset(false);
      this.size = this.baseSize + Math.sin(this.age*1.5)*0.25;
    };
    Particle.prototype.draw = function(ctx){
      ctx.save();
      ctx.globalCompositeOperation = 'lighter';
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.shadowColor = this.color;
      ctx.shadowBlur = this.blur * 6;
      ctx.arc(this.x, this.y, Math.max(0.2,this.size), 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    };

    let particles = [];
    function initParticles(){
      const base = Math.round((W*H) / CONFIG.particleBaseDensity);
      const count = clamp(base, CONFIG.minParticles, CONFIG.maxParticles);
      particles.length = 0;
      for(let i=0;i<count;i++) particles.push(new Particle(true));
    }
    initParticles();

    let mx=null,my=null,pActive=false;
    function onPointerMove(e){
      const p = e.touches ? e.touches[0] : e;
      mx = p.clientX; my = p.clientY; pActive = true;
    }
    function onPointerLeave(){ pActive=false; mx=null; my=null; }
    if(CONFIG.pointerActive){
      window.addEventListener('mousemove', onPointerMove, {passive:true});
      window.addEventListener('touchmove', onPointerMove, {passive:true});
      window.addEventListener('mouseleave', onPointerLeave);
      window.addEventListener('touchend', onPointerLeave);
    }

    let last = performance.now();
    function frame(now){
      const dt = Math.min(0.09, (now - last)/1000);
      last = now;
      const g = ctx.createLinearGradient(0,0,0,H);
      g.addColorStop(0, 'rgba(15,16,18,0.98)');
      g.addColorStop(1, 'rgba(10,11,13,0.98)');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);
      for(const p of particles){ p.step(dt,mx,my,pActive); p.draw(ctx); }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);

    function debounce(fn,t){ let id; return function(){ clearTimeout(id); id = setTimeout(fn, t); }; }
    window.PARTICLES_BG = { set: (obj)=>{ Object.assign(CONFIG,obj); initParticles(); }, getConfig: ()=>JSON.parse(JSON.stringify(CONFIG)) };
  })();
  </script>

  <script>
  /* ======== UI: dropdown, form, car lookup (mock), sms fab & modals ======== */

  // Issue dropdown (simple)
  (function(){
    const dropdown = document.getElementById('issueDropdown');
    if(!dropdown) return;
    const input = dropdown.querySelector('input');
    const list = dropdown.querySelector('.dropdown-list');
    input.addEventListener('focus', () => list.style.display = 'block');
    input.addEventListener('input', () => {
      const filter = input.value.toLowerCase();
      const items = list.querySelectorAll('li');
      items.forEach(li => li.style.display = li.textContent.toLowerCase().includes(filter) ? 'block' : 'none');
    });
    list.querySelectorAll('li').forEach(li => li.addEventListener('click', () => {
      input.value = li.textContent.trim();
      list.style.display = 'none';
    }));
    document.addEventListener('click', e => { if(!dropdown.contains(e.target)) list.style.display = 'none'; });
  })();

  // Date min today
  (function(){
    const dateInput = document.getElementById('date');
    if(dateInput){
      const t = new Date();
      const s = `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
      dateInput.min = s;
    }
  })();

  // contact form submit (simple fetch)
  (function(){
    const form = document.getElementById('contactForm');
    const status = document.getElementById('contactStatus');
    if(!form) return;
    form.addEventListener('submit', async function(e){
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const orig = btn.textContent;
      btn.disabled = true; btn.textContent = 'Skickar...';
      status.style.display = 'none';
      try {
        const fd = new FormData(form);
        const res = await fetch(form.action, { method:'POST', body: fd, headers: { Accept: 'application/json' } });
        if(res.ok){ status.textContent = 'Tack! Ditt meddelande har skickats.'; status.style.display='block'; status.style.background='rgba(34,197,94,.08)'; status.style.color='#b6f0bc'; form.reset(); }
        else { throw new Error('not ok'); }
      } catch(err){
        status.textContent = 'Något gick fel. Vänligen försök igen eller ring oss direkt.'; status.style.display='block'; status.style.background='rgba(239,68,68,.06)'; status.style.color='#ffb8b8';
      } finally { btn.disabled = false; btn.textContent = orig; }
    });
  })();

  // Car lookup (mock). Replace fetchMock with real API endpoint as needed.
  (function(){
    const carInput = document.getElementById('car');
    const carInfo = document.getElementById('carInfo');
    if(!carInput || !carInfo) return;
    let t = null;
    carInput.addEventListener('input', () => { clearTimeout(t); t = setTimeout(onCarChanged, 600); });
    carInput.addEventListener('blur', onCarChanged);

    function showLoading(msg='Hämtar fordonsuppgifter...'){ carInfo.style.display='block'; carInfo.innerHTML = `<div style="color:#ffd27a">${msg}</div>`; }
    function showError(msg){ carInfo.style.display='block'; carInfo.innerHTML = `<div style="color:#ff8a8a">${msg}</div>`; }
    function showData(d){ carInfo.style.display='block'; carInfo.innerHTML = `<div style="display:flex;gap:8px;align-items:flex-start"><div style="min-width:90px;color:rgba(230,230,230,0.6)">Märke</div><div style="flex:1">${escapeHtml(d.make||'—')}</div></div>
      <div style="display:flex;gap:8px;margin-top:6px"><div style="min-width:90px;color:rgba(230,230,230,0.6)">Modell</div><div style="flex:1">${escapeHtml(d.model||'—')}</div></div>
      <div style="display:flex;gap:8px;margin-top:6px"><div style="min-width:90px;color:rgba(230,230,230,0.6)">Årsmodell</div><div style="flex:1">${escapeHtml(d.year||'—')}</div></div>`; }

    function onCarChanged(){
      const reg = (carInput.value || '').trim();
      if(!reg || reg.length < 2){ carInfo.style.display='none'; return; }
      showLoading();
      // MOCK: replace with real API call (must support CORS) if available
      setTimeout(()=> {
        const mock = mockLookup(reg);
        if(mock) showData(mock);
        else showError('Inga uppgifter hittades för detta regnr.');
      }, 500);
    }

    function mockLookup(reg){
      const key = reg.replace(/\s|-/g,'').toUpperCase();
      const db = {
        'ABC123': { make:'Volvo', model:'V60', year:'2017', fuel:'Diesel', vin:'YV1ZZZ1Z2J1234567' },
        'XYZ987': { make:'Toyota', model:'Corolla', year:'2019', fuel:'Bensin', vin:'JTDBR32E720123456' },
        'SWE001': { make:'Volkswagen', model:'Golf', year:'2015', fuel:'Bensin', vin:'WVWZZZ1KZFW000001' }
      };
      return db[key] || null;
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  })();

  // Creator modal
  (function(){
    const creatorModal = document.getElementById('creatorModal');
    const openCreator = document.getElementById('openCreator');
    const closeCreator = document.getElementById('closeCreator');
    if(openCreator){
      openCreator.addEventListener('click', function(e){ e.preventDefault(); creatorModal.classList.add('show'); document.body.classList.add('scroll-lock'); });
    }
    if(closeCreator){
      closeCreator.addEventListener('click', function(e){ e.preventDefault(); creatorModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); });
    }
    if(creatorModal){
      creatorModal.addEventListener('click', function(e){ if(e.target === creatorModal){ creatorModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); } });
    }
  })();

  // SMS chooser modal
  (function(){
    const smsFab = document.getElementById('smsFab');
    const chooserModal = document.getElementById('chooserModal');
    const chooserSms = document.getElementById('chooserSms');
    const chooserClose = document.getElementById('chooserClose');
    const chooserMail = document.getElementById('chooserMail');

    if(!smsFab || !chooserModal) return;

    function getSmsHref(){
      const base = 'sms:+46720040936';
      const body = encodeURIComponent('Hej! Jag skulle vilja be om hjälp med min bil.');
      const ua = navigator.userAgent.toLowerCase();
      return (ua.includes('iphone') || ua.includes('ipad')) ? `${base}&body=${body}` : `${base}?body=${body}`;
    }

    smsFab.addEventListener('click', function(e){ e.preventDefault(); chooserModal.classList.add('show'); document.body.classList.add('scroll-lock'); chooserSms.href = getSmsHref(); });

    chooserClose.addEventListener('click', function(e){ e.preventDefault(); chooserModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); });

    chooserModal.addEventListener('click', function(e){ if(e.target === chooserModal){ chooserModal.classList.remove('show'); document.body.classList.remove('scroll-lock'); } });

    // draggable fab
    (function makeDraggable(el){
      const MARGIN = 12, CLICK_TOL = 6;
      let dragging=false, startX=0, startY=0, startLeft=0, startTop=0, pointerId=null;
      function ensureLeftTop(){
        const r = el.getBoundingClientRect();
        el.style.left = (r.left) + 'px';
        el.style.top = (r.top) + 'px';
        el.style.right = 'auto';
        el.style.bottom = 'auto';
      }
      function clampTop(top){
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        const h = el.getBoundingClientRect().height;
        return Math.min(vh - h - MARGIN, Math.max(MARGIN, top));
      }
      function onDown(e){
        pointerId = e.pointerId;
        try{ e.target.setPointerCapture(pointerId); } catch(_) {}
        dragging = true;
        startX = e.clientX; startY = e.clientY;
        ensureLeftTop();
        startLeft = parseFloat(el.style.left) || el.getBoundingClientRect().left;
        startTop = parseFloat(el.style.top) || el.getBoundingClientRect().top;
        el.style.transition = 'none';
        e.preventDefault();
      }
      function onMove(e){
        if(!dragging || e.pointerId !== pointerId) return;
        const dx = e.clientX - startX, dy = e.clientY - startY;
        el.style.left = Math.round(startLeft + dx) + 'px';
        el.style.top = Math.round(startTop + dy) + 'px';
        e.preventDefault();
      }
      function onUp(e){
        if(e.pointerId !== pointerId) return;
        try{ e.target.releasePointerCapture(pointerId); } catch(_) {}
        const dx = e.clientX - startX, dy = e.clientY - startY;
        const moved = Math.hypot(dx, dy);
        dragging = false; pointerId = null;
        const rect = el.getBoundingClientRect();
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const side = (rect.left + rect.width/2 < vw/2) ? 'left' : 'right';
        const top = clampTop(parseFloat(el.style.top || rect.top));
        el.style.top = Math.round(top) + 'px';
        if(side === 'left'){ el.style.left = MARGIN + 'px'; el.style.right = 'auto'; } else { el.style.right = MARGIN + 'px'; el.style.left = 'auto'; }
        try{ localStorage.setItem('smsFabPosition', JSON.stringify({ side, top })); } catch(_){}
        if(moved > CLICK_TOL){
          el.addEventListener('click', function once(ev){ ev.stopImmediatePropagation(); ev.preventDefault(); }, { once:true, capture:true });
        }
      }
      function restore(){
        try{
          const saved = JSON.parse(localStorage.getItem('smsFabPosition')||'null');
          if(saved && (saved.side==='left'||saved.side==='right')){
            el.style.top = Math.max(MARGIN, saved.top) + 'px';
            if(saved.side==='left'){ el.style.left = MARGIN + 'px'; el.style.right = 'auto'; } else { el.style.right = MARGIN + 'px'; el.style.left = 'auto'; }
          }
        }catch(_){}
      }
      el.addEventListener('pointerdown', onDown, { passive:false });
      window.addEventListener('pointermove', onMove, { passive:false });
      window.addEventListener('pointerup', onUp, { passive:false });
      window.addEventListener('pointercancel', onUp, { passive:false });
      restore();
    })(document.getElementById('smsFab'));
  })();
  </script>

</body>
</html>